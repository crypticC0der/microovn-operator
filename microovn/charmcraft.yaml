# This file configures Charmcraft.
# See https://juju.is/docs/sdk/charmcraft-config for guidance.

# (Required)
type: charm


# (Recommended)
title: MicroOVN Charm

links:
  source: https://github.com/canonical/microovn-operator

# (Required for 'charm' type)
platforms:
  ubuntu@24.04:amd64:
  ubuntu@24.04:arm64:
  ubuntu@24.04:ppc64el:
  ubuntu@24.04:riscv64:
  ubuntu@24.04:s390x:

parts:
  poetry-deps:
    plugin: nil
    build-packages:
      - curl
    override-build: |
      PIP_BREAK_SYSTEM_PACKAGES=true python3 -m pip install --user poetry==2.2.1 poetry-plugin-export==1.9.0
      ln -sf "$HOME/.local/bin/poetry" /usr/local/bin/poetry
      poetry config --local installer.no-binary :all:
    build-environment:
      - POETRY_VERSION: "2.2.1"
  charm:
    source: .
    plugin: poetry
    after: [poetry-deps]
    build-packages:
      - git
      - python3-dev
      - cargo-1.85
      - libffi-dev
      - libssl-dev
      - pkg-config
      - rustc-1.85

config:
  options:
    log-level:
      default: "info"
      type: string

requires:
  cluster:
    interface: worker-cluster
    limit: 1

  certificates:
    interface: tls-certificates

charm-libs:
  - lib: tls_certificates_interface.tls_certificates
    version: "4"
  - lib: microcluster_token_distributor.token_distributor 
    version: "0.1"
